{% extends "base.html" %}
{% block content %}

<div class="path-cloud">
	<button class="mdl-button mdl-js-button mdl-button--icon right-action-button mdl-button--colored" onclick="location.href='{% url 'folder:index' folder_path %}'" type="button">
		<i class="material-icons right-action-button">edit</i>
	</button>

	<div class="center-vert">
		<a class="center-vert" href="{% url 'folder:index' 'all' %}">
			<i class="material-icons center-vert">first_page</i>
		</a>
		{% for p in parent_paths %}
		{% if p.0 != 'all' %}
		<p>/</p> <a href="{% url 'folder:index' p.0 %}">{{ p.1 }}</a>
		{% endif %}
		{% endfor %}
		{% ifnotequal folder_path 'all' %}
		<a class="center-vert" href="{% url 'folder:index' parent_path %}">
			<i class="material-icons center-vert">chevron_left</i>
		</a>
		{% endifnotequal %}
	</div>
</div>

<div class="cloud">
	<form action="{% url 'folder:edit_folder_name' folder_path %}" method="post">
	{% csrf_token %}
		<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
			<input class="mdl-textfield__input" type="text" name="pretty_name" id="txt-{{ folder.folder_name }}" value="{{ folder.pretty_name }}">
			<label class="mdl-textfield__label" for="txt-{{ folder.folder_name }}">Edytuj nazwę aktualnego folderu</label>
		</div>
	</form>

	<form action="{% url 'folder:edit_tags' folder_path %}" method="post" id="tags_form">
	{% csrf_token %}
		<button type="submit" form="tags_form" class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent">
			Zapisz tagi
		</button>
	</form>
</div>

<select form="tags_form" id="select-tags" name="tags[]" multiple placeholder="Dodaj tagi">
</select>

<script>
$(function() {
	var $select = $('#select-tags').selectize({
		plugins: ['remove_button'],
		persist: false,
		options: [
			{% for tag, selected in tag_data %}
				{id: {{ tag.id }}, value: '{{ tag.id }}', text: '{{ tag.name }}', category: '{{ tag.type_id }}'},
			{% endfor %}
		],
		render: {
			item: function(data, escape) {
				return '<span class="mdl-chip mdl-chip--deletable">' +
							'<span class="category-chip category-color-' + escape(data.category) + '"></span>' +
							'<span class="mdl-chip__text">' + escape(data.text) + '</span>' +
						'</span>';
			}
		}
	});

	var selectize = $select[0].selectize;
	{% for tag, selected in tag_data %}
		{% if selected %}
			selectize.addItem({{ tag.id }})
		{% endif %}
	{% endfor %}

});
</script>

{% for son in sons %}
{% with son_path_prefix|add:son.folder_name as son_path %}
<div class="cloud folder-nonclick-cloud">
	<button id="show-delete-son-{{ forloop.counter }}" class="mdl-button mdl-js-button mdl-button--icon right-action-button" type="button">
		<i class="material-icons right-action-button">delete_outline</i>
	</button>

	<div class="center-vert">
		<i class="material-icons">arrow_forward_ios</i>
		{{ son.pretty_name }}
	</div>
</div>

<form action="{% url 'folder:delete_folder' folder_path %}" method="post" id="delete_form-son-{{ forloop.counter }}">
	{% csrf_token %}
	<input type="hidden" name="pretty_name" value="{{ son.pretty_name }}" />
</form>

<dialog class="mdl-dialog" width=100 id='dialog-son-{{ forloop.counter }}'>
	<h5>Czy chcesz usunąć folder "{{ son.pretty_name }}"?</h5>
	<div class="mdl-dialog__content">
	</div>
	<div class="mdl-dialog__actions">
		<button form="delete_form-son-{{ forloop.counter }}" type="submit" class="mdl-button">Usuń</button>
		<button type="button" class="mdl-button close">Anuluj</button>
	</div>
</dialog>

<script>
	activate_dialog('son-{{ forloop.counter }}');
</script>
{% endwith %}
{% endfor %}

<div class="cloud">
	<form action="{% url 'folder:add_folder' folder_path %}" method="post">
	{% csrf_token %}
		<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
			<input class="mdl-textfield__input" type="text" name="pretty_name" id="txt">
			<label class="mdl-textfield__label" for="txt">Nazwa nowego podfolderu</label>
		</div>
	</form>
</div>

{% for problem in problems %}
<div class="problem-cloud">
	<button class="mdl-button mdl-js-button mdl-button--icon right-action-button" type="button"
		id="show-delete-problem-{{ forloop.counter }}">
		<i class="material-icons right-action-button">delete_outline</i>
	</button>

	<button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--mini-fab problem-cloud-button"
			onclick="location.href='{% url 'problems:details' problem.id %}'" type="button">
		{{ forloop.counter }}</button>
	<p>{{ problem.statement }}</p>
</div>

<form action="{% url 'folder:delete_problem' folder_path %}" method="post" id="delete_form-problem-{{ forloop.counter }}">
	{% csrf_token %}
	<input type="hidden" name="p_id" value="{{ problem.id }}" />
</form>

<dialog class="mdl-dialog" width=100 id='dialog-problem-{{ forloop.counter }}'>
	<h5>Czy chcesz usunąć zadanie?</h5>
	<div class="mdl-dialog__content">
	</div>
	<div class="mdl-dialog__actions">
		<button form="delete_form-problem-{{ forloop.counter }}" type="submit" class="mdl-button">Usuń</button>
		<button type="button" class="mdl-button close">Anuluj</button>
	</div>
</dialog>

<script>
	activate_dialog('problem-{{ forloop.counter }}');
</script>
{% endfor %}

<div class="cloud">
	<form action="{% url 'folder:add_problem' folder_path %}" method="post">
	{% csrf_token %}
		<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
			<input class="mdl-textfield__input" type="text" name="p_id" id="add-txt">
			<label class="mdl-textfield__label" for="add-txt">Dodanie zadania (ID)</label>
		</div>
	</form>
</div>

{% endblock %}
